# Homebrew Cask Style Guide

This document outlines the requirements for maintaining Homebrew-compatible casks in this repository, particularly when generated by GoReleaser.

## Key Issues with GoReleaser Casks

### ❌ Problems with Default GoReleaser Output:
1. **Linux blocks** (`on_linux`) are invalid - Homebrew casks are macOS-only
2. **Description violations**: Too long, starts with article, ends with period
3. **Stanza order**: Must follow Homebrew's specific ordering
4. **Line length**: Must be ≤118 characters

### ✅ Correct Cask Format:

```ruby
cask "your-app-name" do
  version "1.0.0"
  sha256 arm: "arm64-hash",
         intel: "amd64-hash"

  url "https://github.com/user/repo/releases/download/v#{version}/app_#{version}_darwin_#{Hardware::CPU.arch}.tar.gz"
  name "Proper Name"
  desc "Short description under 80 chars, no article start, no period"
  homepage "https://github.com/user/repo"

  livecheck do
    skip "Auto-generated on release."
  end

  binary "binary-name"
end
```

## Stanza Order (Critical!)

Homebrew requires specific stanza ordering:

1. `version`
2. `sha256` 
3. `url`
4. `name`
5. `desc`
6. `homepage`
7. `livecheck`
8. Artifacts (`binary`, `app`, etc.)

## Description Rules

- **Length**: < 80 characters
- **Start**: No articles ("A", "An", "The")
- **End**: No punctuation
- **Content**: Brief, descriptive

### ✅ Good Examples:
- `"CLI for managing JavaScript packages"`
- `"Fast text search tool"`
- `"Git workflow manager"`

### ❌ Bad Examples:
- `"A CLI for managing JavaScript packages."` (article + period)
- `"This is a really long description that exceeds the character limit"` (too long)

## GoReleaser Configuration Fix

To generate proper casks, update your `.goreleaser.yml`:

```yaml
brews:
  - name: your-app
    repository:
      owner: username
      name: homebrew-tap-name
    homepage: "https://github.com/username/your-app"
    description: "Short description under 80 chars"
    license: "MIT"
    # Remove any linux-related configurations for the brew section
    install: |
      bin.install "your-binary"
```

## Manual Cask Fixes

When GoReleaser generates invalid casks, apply these fixes:

1. **Remove `on_linux` blocks entirely**
2. **Combine architecture handling**:
   ```ruby
   # Instead of separate on_intel/on_arm blocks:
   sha256 arm: "arm-hash", intel: "intel-hash"
   url "...#{Hardware::CPU.arch}..."
   ```
3. **Fix description** to meet style requirements
4. **Reorder stanzas** according to Homebrew standards

## CI Workflow Notes

Our audit workflow does:
1. ✅ **Tap setup** with canonical name (`user/repo` not `user/homebrew-repo`)
2. ✅ **Style checking** with `brew style --display-cop-names`
3. ✅ **Ruby syntax validation**
4. ✅ **Cask audit** with `brew audit --cask --strict --online`

Avoided `brew readall` because it's too strict for GoReleaser casks.

## Common Errors & Solutions

| Error | Solution |
|-------|----------|
| `desc stanza out of order` | Move `desc` after `name` |
| `Description is too long` | Shorten to < 80 characters |
| `shouldn't start with article` | Remove "A", "An", "The" |
| `shouldn't end with full stop` | Remove trailing period |
| `Line is too long` | Split long lines, esp. URLs |
| `on_linux` blocks | Remove entirely (macOS only) |
| `Invalid cask: No Cask with this name exists` | Fix tap name or cask discovery |

## Future Prevention

1. **Always test casks locally** before CI
2. **Run `brew style Casks/*.rb`** to catch style issues
3. **Use `brew audit --cask --new <cask-name>`** for new casks
4. **Keep descriptions short and punchy**
5. **Update GoReleaser config** to generate cleaner casks

## References

- [Homebrew Cask Cookbook](https://docs.brew.sh/Cask-Cookbook)
- [Acceptable Casks](https://docs.brew.sh/Acceptable-Casks)
- [GoReleaser Brew Documentation](https://goreleaser.com/customization/homebrew/)
